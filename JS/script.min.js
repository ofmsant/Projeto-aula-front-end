document.addEventListener("DOMContentLoaded",()=>{let e=document.createElement("div");function t(t){e.textContent=t}function a(){F(),D(),T(),n(),l(),s(),i(),iniciarMascaras(),iniciarCEP(),iniciarFormulario()}e.setAttribute("aria-live","polite"),e.setAttribute("class","sr-only"),document.body.appendChild(e);let o=(e,t=document)=>t.querySelector(e),r=(e,t=document)=>Array.from(t.querySelectorAll(e));function n(){let e=document.querySelectorAll(".nav-toggle"),t=document.querySelector(".main-nav");e.forEach(e=>{e.setAttribute("aria-expanded","false"),e.setAttribute("aria-controls","menu-principal");let a=()=>{t.classList.toggle("open");let a=t.classList.contains("open");t.style.display=a?"block":"",e.setAttribute("aria-expanded",a)};e.addEventListener("click",a),e.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),a())})})}function l(){let e=document.querySelectorAll(".has-submenu");e.forEach(e=>{e.addEventListener("mouseenter",()=>{if(window.innerWidth>800){let t=e.querySelector(".submenu");t&&(t.style.display="block")}}),e.addEventListener("mouseleave",()=>{if(window.innerWidth>800){let t=e.querySelector(".submenu");t&&(t.style.display="none")}})})}function s(){document.querySelectorAll(".has-submenu > a").forEach(e=>{let t=e.parentElement.querySelector(".submenu");t&&(e.setAttribute("aria-expanded","false"),e.setAttribute("aria-haspopup","true"),e.addEventListener("keydown",a=>{"ArrowDown"===a.key&&(a.preventDefault(),t.style.display="block",e.setAttribute("aria-expanded","true"),t.querySelector("a").focus()),"Escape"===a.key&&(t.style.display="none",e.setAttribute("aria-expanded","false"),e.focus())}))})}function i(){let e=r(".carousel");e.forEach(e=>{let t=o(".carousel-track",e),a=r(".carousel-item",t),n=o(".carousel-prev",e),l=o(".carousel-next",e),s=0,i=()=>{t.style.transform=`translateX(-${100*s}%)`};a.forEach((e,t)=>{e.setAttribute("aria-hidden",t!==s)}),n&&n.addEventListener("click",()=>{s=(s-1+a.length)%a.length,i()}),l&&l.addEventListener("click",()=>{s=(s+1)%a.length,i()});let d=setInterval(()=>{s=(s+1)%a.length,i()},4e3);e.addEventListener("mouseenter",()=>clearInterval(d)),e.addEventListener("mouseleave",()=>d=setInterval(()=>{s=(s+1)%a.length,i()},4e3))})}let d=e=>(e=(e||"").replace(/\D/g,"").slice(0,11)).length<=3?e:e.length<=6?e.replace(/(\d{3})(\d+)/,"$1.$2"):e.length<=9?e.replace(/(\d{3})(\d{3})(\d+)/,"$1.$2.$3"):e.replace(/(\d{3})(\d{3})(\d{3})(\d{0,2})/,"$1.$2.$3-$4"),c=e=>(e=(e||"").replace(/\D/g,"").slice(0,11)).length<=2?e:e.length<=6?e.replace(/(\d{2})(\d+)/,"($1) $2"):e.length<=10?e.replace(/(\d{2})(\d{4})(\d+)/,"($1) $2-$3"):e.replace(/(\d{2})(\d{5})(\d{0,4})/,"($1) $2-$3"),u=e=>(e=(e||"").replace(/\D/g,"").slice(0,8)).length<=5?e:e.replace(/(\d{5})(\d+)/,"$1-$2"),p=o("#cpf"),y=o("#telefone"),v=o("#cep");p&&p.addEventListener("input",e=>e.target.value=d(e.target.value)),y&&y.addEventListener("input",e=>e.target.value=c(e.target.value)),v&&v.addEventListener("input",e=>e.target.value=u(e.target.value));let m=(e,t="sucesso")=>{let a=document.createElement("div");a.className=`alerta ${"erro"===t?"erro":"sucesso"===t?"sucesso":""}`,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.classList.add("hide"),a.style.opacity="0"},2500),setTimeout(()=>a.remove(),3200)},g=r('input[name="tipo"]'),f=o("#dadosPessoaisFieldset"),h=o("#enderecoFieldset"),b=o("#avisoObrigatorio"),E=o("#infoAdicional"),L=o("#areaInteresseContainer"),k=o("#valorDoacaoContainer"),$=o("#mensagemLabel"),x=o("#avisoSelecao");g.length>0&&g.forEach(e=>{e.addEventListener("change",()=>{f&&(f.style.display="block"),h&&(h.style.display="block"),b&&(b.style.display="block"),E&&(E.style.display="block"),x&&(x.style.display="none"),"voluntario"===e.value?(L&&(L.style.display="block"),k&&(k.style.display="none"),$&&($.textContent="Por que deseja ser volunt\xe1rio?"),o("#area")&&(o("#area").required=!0),o("#valor_doacao")&&(o("#valor_doacao").required=!1)):"doador"===e.value&&(k&&(k.style.display="block"),L&&(L.style.display="none"),$&&($.textContent="Por que deseja ser doador?"),o("#valor_doacao")&&(o("#valor_doacao").required=!0),o("#area")&&(o("#area").required=!1))})}),v&&v.addEventListener("blur",async()=>{let e=v.value.replace(/\D/g,"");if(8===e.length)try{let t=await fetch(`https://viacep.com.br/ws/${e}/json/`),a=await t.json();a.erro||(o("#endereco").value=a.logradouro||"",o("#bairro")&&(o("#bairro").value=a.bairro||""),o("#cidade").value=a.localidade||"",o("#estado").value=a.uf||"")}catch(r){console.error("Erro ao buscar CEP:",r)}});let C=o("#cadastroForm"),q=!1,_=o("#lista-voluntarios")||(()=>{let e=document.createElement("div");e.id="lista-voluntarios";let t=o(".form-section");return t?t.after(e):document.body.appendChild(e),e.style.display="none",e})(),A=()=>JSON.parse(localStorage.getItem("voluntarios")||"[]"),S=e=>localStorage.setItem("voluntarios",JSON.stringify(e)),N=e=>{if(!confirm("Tem certeza que deseja excluir este cadastro?"))return;let t=A();e>=0&&e<t.length?(t.splice(e,1),S(t),m("Cadastro exclu\xeddo.","erro"),w()):m("Erro ao excluir. \xcdndice inv\xe1lido.","erro")},w=()=>{let e=A();if(_.innerHTML="",0===e.length){_.innerHTML="<p style='text-align:center;color:var(--muted)'>Nenhum volunt\xe1rio cadastrado.</p>";return}let t=document.createElement("p");t.className="contador",t.innerHTML=`ðŸ‘¥ Total: <strong>${e.length}</strong>`,_.appendChild(t),e.forEach((e,t)=>{let a=document.createElement("div");a.className="voluntario-card",a.innerHTML=`
          <div class="card-header">
              <h3>Cadastro ${t+1}</h3>
              <button class="btn-excluir" data-index="${t}" data-action="delete">âœ– Excluir</button>
          </div>

          <p><strong>Tipo:</strong> ${e.tipo||"N\xe3o informado"}</p>
          <p><strong>Nome:</strong> ${e.nome||"N\xe3o informado"}</p>
          <p><strong>E-mail:</strong> ${e.email||"N\xe3o informado"}</p>
          <p><strong>Telefone:</strong> ${e.telefone||"N\xe3o informado"}</p>
          <p><strong>CPF (formatado):</strong> ${e.cpf||"N\xe3o informado"}</p>
          <p><strong>CPF (apenas d\xedgitos):</strong> ${e.cpf_clean||"N\xe3o informado"}</p>
          <p><strong>Nascimento:</strong> ${e.nascimento||"N\xe3o informado"}</p>

          <p><strong>Endere\xe7o:</strong> ${e.endereco||"N\xe3o informado"}</p>
          <p><strong>Bairro:</strong> ${e.bairro||"N\xe3o informado"}</p>
          <p><strong>CEP:</strong> ${e.cep||"N\xe3o informado"}</p>
          <p><strong>Cidade:</strong> ${e.cidade||"N\xe3o informado"} - ${e.estado||""}</p>

          ${"voluntario"===e.tipo?`
            <p><strong>\xc1rea de interesse:</strong> ${e.area||"N\xe3o informado"}</p>
          `:""}

          ${"doador"===e.tipo?`
            <p><strong>Valor da doa\xe7\xe3o:</strong> R$ ${e.valor_doacao?Number(e.valor_doacao).toFixed(2).replace(".",","):"0,00"}</p>
          `:""}

          <p><strong>Mensagem:</strong> ${e.mensagem||"Nenhuma"}</p>
        `,_.appendChild(a)})};function D(){let e=document.querySelector("#toggle-contrast");if(!e){console.warn("Bot\xe3o de alto contraste n\xe3o encontrado");return}"on"===localStorage.getItem("high-contrast")&&document.body.classList.add("high-contrast"),e.addEventListener("click",()=>{document.body.classList.toggle("high-contrast");let e=document.body.classList.contains("high-contrast");localStorage.setItem("high-contrast",e?"on":"off")})}function T(){let e=document.querySelector("#toggle-dark");e&&("on"===localStorage.getItem("dark-mode")&&document.body.classList.add("dark"),e.addEventListener("click",()=>{document.body.classList.toggle("dark");let e=document.body.classList.contains("dark");localStorage.setItem("dark-mode",e?"on":"off")}))}function F(){let e=document.getElementById("accessibilityDrawer"),t=document.getElementById("drawerToggle");if(!e||!t)return;t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","accessibilityDrawer");let a=()=>{let a=e.classList.toggle("open");t.setAttribute("aria-expanded",a),a&&e.querySelector("button.drawer-btn").focus()};t.addEventListener("click",a),t.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),a())})}_.addEventListener("click",e=>{let t=e.target;if(t.matches('.btn-excluir[data-action="delete"]')){let a=parseInt(t.dataset.index,10);N(a)}});let P=document.createElement("button");P.className="btn",P.textContent="Ver cadastros",P.addEventListener("click",()=>{q?(_.style.display="none",P.textContent="Ver cadastros",q=!1):(w(),_.style.display="block",P.textContent="Esconder cadastros",q=!0,window.scrollTo({top:_.offsetTop-20,behavior:"smooth"}))}),document.body.appendChild(P);let I=document.createElement("button");I.className="btn btn-ghost",I.textContent="Limpar cadastros",I.addEventListener("click",()=>{confirm("Confirma exclus\xe3o de TODOS os cadastros?")&&(localStorage.removeItem("voluntarios"),q&&w(),m("Cadastros apagados.","erro"))}),document.body.appendChild(I),C&&(C.addEventListener("submit",e=>{e.preventDefault();let a=C.querySelectorAll("[required]"),o=!0;if(a.forEach(e=>{(!e.closest("#dadosPessoaisFieldset")||"none"!==e.closest("#dadosPessoaisFieldset").style.display)&&(e.closest("#enderecoFieldset")&&"none"===e.closest("#enderecoFieldset").style.display||(e.value&&""!==e.value.trim()?e.classList.remove("invalid"):(e.classList.add("invalid"),o=!1)))}),!o){m("Por favor, preencha os campos destacados.","erro"),t("Erros no formul\xe1rio. Preencha os campos obrigat\xf3rios.");return}let r=C.querySelector('input[name="tipo"]:checked')?.value||"voluntario",n=C.cpf?.value||"",l=n.replace(/\D/g,""),s=d(n),i={tipo:r,nome:C.nome.value.trim(),email:C.email.value.trim(),cpf:s,cpf_clean:l,telefone:C.telefone.value.trim(),nascimento:C.data_nascimento?.value||"",endereco:C.endereco?.value||"",bairro:C.bairro?.value||"",cep:C.cep?.value||"",cidade:C.cidade?.value||"",estado:C.estado?.value||"",mensagem:C.mensagem?.value||"",area:"voluntario"===r&&C.area?.value||"",valor_doacao:"doador"===r&&C.valor_doacao?.value||""},c=A();c.push(i),S(c),m("Cadastro realizado com sucesso!"),C.reset(),f&&(f.style.display="none"),h&&(h.style.display="none"),b&&(b.style.display="none"),E&&(E.style.display="none"),L&&(L.style.display="none"),k&&(k.style.display="none"),x&&(x.style.display="block"),q&&w()}),C.addEventListener("input",e=>{e.target.matches("input, textarea, select")&&e.target.classList.remove("invalid")})),document.addEventListener("keydown",e=>{"ArrowLeft"===e.key?r(".carousel").forEach(e=>{let t=o(".carousel-prev",e);t&&t.click()}):"ArrowRight"===e.key&&r(".carousel").forEach(e=>{let t=o(".carousel-next",e);t&&t.click()})}),r(".main-nav a").forEach(e=>{e.addEventListener("click",t=>{if(t.metaKey||t.ctrlKey||t.shiftKey)return;let o=e.getAttribute("href");!o||o.startsWith("http")||(t.preventDefault(),fetch(o).then(e=>e.text()).then(e=>{let t=new DOMParser,r=t.parseFromString(e,"text/html"),n=r.querySelector("main");n?(document.querySelector("main").innerHTML=n.innerHTML,window.history.pushState({},"",o),a()):window.location.href=o}).catch(()=>{window.location.href=o}))})}),window.addEventListener("popstate",()=>{a()}),a()}),document.querySelectorAll(".has-submenu > a").forEach(e=>{e.addEventListener("click",t=>{if(window.innerWidth<=800){t.preventDefault();let a=e.parentElement.querySelector(".submenu");a.style.display="block"===a.style.display?"none":"block"}})});